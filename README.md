# VHS / Virtual Hystology Staining /
## CUT: –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä–∞—à–∏–≤–∞–Ω–∏–µ –≥–∏—Å—Ç–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä–∞—à–∏–≤–∞–Ω–∏–µ –≥–∏—Å—Ç–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** —Å –ø–æ–º–æ—â—å—é **Contrastive Unpaired Translation (CUT)**.  
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–º–æ–¥—É–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥**, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏–π:
- –†–∞–∑—Ä–µ–∑–∫—É –±–æ–ª—å—à–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –Ω–∞ –ø–∞—Ç—á–∏ (`2048x2048` —Å –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ–º `512px`)
- –û–±—É—á–µ–Ω–∏–µ **–Ω–µ–π—Ä–æ—Å–µ—Ç–∏ CUT** –Ω–∞ –ø–∞—Ç—á–∞—Ö  
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ, –∑–∞–≥—Ä—É–∑–∫—É –∏ –∏–Ω—Ñ–µ—Ä–µ–Ω—Å –º–æ–¥–µ–ª–∏  
- **Callbacks** –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —á–µ–∫–ø–æ–∏–Ω—Ç–æ–≤  

## üìå –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞:
- **–†–∞–∑—Ä–µ–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** –Ω–∞ –ø–∞—Ç—á–∏ (2048x2048) –∏ –∏—Ö —Å–±–æ—Ä–∫–∞ –æ–±—Ä–∞—Ç–Ω–æ
- **–û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ CUT**
- **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –æ–±—É—á–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ –∫ –Ω–æ–≤—ã–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º**
- **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è GPU (Nvidia A100)**

---

## üöÄ **1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞**
### üìå **1.1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**
```sh
pip install torch torchvision tensorboard tqdm numpy opencv-python pillow
```

### üìå **1.2. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**
```sh
git clone https://github.com/your-repo/cut-histology.git
cd cut-histology
```

## üõ† **2. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö**
### üõ† **2.1. –†–∞–∑—Ä–µ–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π**
–ü–µ—Ä–µ–¥ –æ–±—É—á–µ–Ω–∏–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–∞–∑—Ä–µ–∑–∞—Ç—å –±–æ–ª—å—à–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –ø–∞—Ç—á–∏.
```sh
python main.py --image path/to/original_image.png --output_patches patches/ --output_image reconstructed.png
```

–ß—Ç–æ –¥–µ–ª–∞–µ—Ç —ç—Ç–æ—Ç —à–∞–≥?
- **–†–∞–∑—Ä–µ–∑–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ –ø–∞—Ç—á–∏ 2048x2048 —Å 512px –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ–º**
- **–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Ö –≤ patches/**
- **–ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–∑–∂–µ —Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞—Ç–Ω–æ**

## üéì **3. –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ CUT**
### üéì **3.1. –ó–∞–ø—É—Å–∫ –æ–±—É—á–µ–Ω–∏—è**
```sh
python train.py --source path/to/source_patches --target path/to/target_patches
```
–ß—Ç–æ –¥–µ–ª–∞–µ—Ç —ç—Ç–æ—Ç —à–∞–≥?
- **–ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø–∞—Ç—á–∏ –Ω–µ–º–∞—Ä–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏ –æ–∫—Ä–∞—à–µ–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π**
- **–ó–∞–ø—É—Å–∫–∞–µ—Ç CUT**
- **–°–æ—Ö—Ä–∞–Ω—è–µ—Ç —á–µ–∫–ø–æ–∏–Ω—Ç—ã –º–æ–¥–µ–ª–∏ –≤ checkpoints/**
- **–õ–æ–≥–∏—Ä—É–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –≤ TensorBoard**

### üéì **3.2. –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ TensorBoard**
```sh
tensorboard --logdir logs
```
–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä: http://localhost:6006/

## üíæ **4. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏**
### üíæ **4.1. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ –ø–æ—Å–ª–µ –æ–±—É—á–µ–Ω–∏—è**
–ú–æ–¥–µ–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è, –Ω–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —ç—Ç–æ –≤—Ä—É—á–Ω—É—é:

```python
from utils.model_utils import save_model

save_model(model, optimizer, epoch)
```

### üíæ **4.2. –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏**

```python
from utils.model_utils import load_model

model = load_model("checkpoints/cut_model_epoch_50.pth")
```

### üé® **5. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ –∫ –Ω–æ–≤–æ–º—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é**
```sh
python apply_model.py --checkpoint checkpoints/cut_model_epoch_50.pth --input path/to/input.png --output path/to/output.png
```

–ß—Ç–æ –¥–µ–ª–∞–µ—Ç —ç—Ç–æ—Ç —à–∞–≥?
- **–ó–∞–≥—Ä—É–∂–∞–µ—Ç –æ–±—É—á–µ–Ω–Ω—É—é –º–æ–¥–µ–ª—å**
- **–ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ Tensor**
- **–ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç –µ–≥–æ —á–µ—Ä–µ–∑ CUT**
- **–°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ**

### üìÇ **6. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞**
```
üì¶
‚îú‚îÄ‚îÄ üìÇ checkpoints/         # –ß–µ–∫–ø–æ–∏–Ω—Ç—ã –æ–±—É—á–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏
‚îú‚îÄ‚îÄ üìÇ logs/                # –õ–æ–≥–∏ –æ–±—É—á–µ–Ω–∏—è –¥–ª—è TensorBoard
‚îú‚îÄ‚îÄ üìÇ patches/             # –ü–∞–ø–∫–∞ –¥–ª—è –ø–∞—Ç—á–µ–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
‚îú‚îÄ‚îÄ üìÇ utils/               # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ üèó cut_model.py          # –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–¥–µ–ª–∏ CUT
‚îÇ   ‚îú‚îÄ‚îÄ üì¶ dataset.py            # –î–∞—Ç–∞—Å–µ—Ç –¥–ª—è –æ–±—É—á–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ üñº image_processing.py   # –†–∞–∑—Ä–µ–∑–∫–∞ –∏ —Å–±–æ—Ä–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ üìù metadata.py           # –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è—Ö
‚îÇ   ‚îú‚îÄ‚îÄ üíæ model_utils.py        # –§—É–Ω–∫—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è/–∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏
‚îú‚îÄ‚îÄ üñº apply_model.py       # –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –æ–±—É—á–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏
‚îú‚îÄ‚îÄ üñº main.py              # –†–∞–∑—Ä–µ–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –Ω–∞ –ø–∞—Ç—á–∏
‚îú‚îÄ‚îÄ üéì train.py             # –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ CUT
‚îú‚îÄ‚îÄ üìú README.md            # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞

```

### üõ† **7. –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è**
- **–£–ª—É—á—à–∏—Ç—å —Å–±–æ—Ä–∫—É –±–æ–ª—å—à–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø–æ—Å–ª–µ –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞**
- **–î–æ–±–∞–≤–∏—Ç—å –ø–∞–∫–µ—Ç–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π**
- **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ñ–µ—Ä–µ–Ω—Å –º–æ–¥–µ–ª–∏ (TorchScript)**
- **–î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –¥—Ä—É–≥–∏—Ö GAN-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä**